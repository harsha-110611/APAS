<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Mechanical Quiz</title>
<style>
/* ===== Body & Canvas ===== */
html, body {
  margin:0; padding:0; width:100%; height:100%;
  overflow:hidden;
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(135deg,#0d0d0d,#1a1a1a);
}
canvas { display:block; position:absolute; top:0; left:0; z-index:1; }

/* ===== Quiz UI ===== */
body {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: relative;
}

#question {
  font-size: 26px;
  margin-bottom: 50px;
  text-align: center;
  max-width: 80%;
  min-height: 70px;
  color: #fff;
  z-index: 2;
  text-shadow: 0 0 10px #000;
}

#timer {
  position: absolute;
  top: 15px;
  right: 20px;
  font-size: 24px;
  font-weight: bold;
  color: #ff4444;
  z-index: 2;
}

.options {
      display: flex;
      gap: 45px;
      perspective: 1000px;
      justify-content: center;
      z-index: 2;
    }

.card {
  width: 200px;
  height: 260px;
  position: relative;
  cursor: pointer;
  transform-style: preserve-3d;
  transition: transform 0.6s;
  z-index: 2;
}
.card.flipped { transform: rotateY(180deg); }

.card .face {
  position: absolute;
  width: 100%;
  height: 100%;
  backface-visibility: hidden;
  border-radius: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  font-weight: bold;
  box-shadow: 0 4px 10px rgba(0,0,0,0.5);
  padding: 10px;
  text-align: center;
}

.front {
  background: #ffffffaa;
  border: 2px solid #00bfff;
  color: #00bfff;
}
.back {
  background: #00bfff;
  color: white;
  transform: rotateY(180deg);
}

.fall {
  animation: fallDown 0.8s forwards;
}
@keyframes fallDown {
  to {
    transform: translateY(450px) rotate(25deg);
    opacity: 0;
  }
}

#score {
  position: fixed;
  bottom: 40px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 20px;
  font-weight: bold;
  color: #fff;
  z-index: 2;
}

/* âœ… Civil-Style Play Again Button */
#playAgainContainer {
  display: none;
  z-index: 2;
  margin-top: 30px;
}
#playAgainBtn {
  position: relative;
  padding: 0.5rem 1.25rem;
  border-radius: 9999px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  font-weight: bold;
  border: 3px solid #ffffff4d;
  background-color: rgb(0 107 179);
  color: #fff;
  cursor: pointer;
  overflow: hidden;
  font-size: 15px;
  transition: all 0.3s ease-in-out;
}
#playAgainBtn:hover {
  transform: scale(1.05);
  border-color: #fff9;
}
#playAgainBtn::before {
  content: "";
  position: absolute;
  width: 100px;
  height: 100%;
  background: linear-gradient(
    120deg,
    rgba(255, 255, 255, 0) 30%,
    rgba(255, 255, 255, 0.8),
    rgba(255, 255, 255, 0) 70%
  );
  top: 0;
  left: -100px;
  opacity: 0.6;
  pointer-events: none;
}
#playAgainBtn:hover::before {
  animation: shine 1.5s ease-out infinite;
}
@keyframes shine {
  0% { left: -100px; }
  100% { left: 100%; }
}
</style>
</head>
<body>

<canvas id="mech"></canvas>

<div id="timer">30</div>
<div id="question">Loading Question...</div>
<div class="options" id="options"></div>
<div id="score">Score: 0</div>

<!-- âœ… Civil quiz style Play Again container -->
<div id="playAgainContainer">
  <button id="playAgainBtn" onclick="goToDepartments()">Play Again</button>
</div>

<script>
// ===== Mechanical bolts background =====
const canvas = document.getElementById("mech");
const ctx = canvas.getContext("2d");

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

class Bolt {
  constructor() { this.reset(); }
  reset() {
    this.x = Math.random() * canvas.width;
    this.y = Math.random() * canvas.height;
    this.size = 20 + Math.random() * 20;
    this.angle = Math.random() * Math.PI * 2;
    this.speed = 0.002 + Math.random() * 0.004;
    this.color = Math.random() < 0.5 ? "#ffaa00" : "#00e6e6";
  }
  draw(time) {
    ctx.save();
    ctx.translate(this.x, this.y);
    ctx.rotate(this.angle + time * this.speed);
    ctx.beginPath();
    for (let i = 0; i < 6; i++) {
      let theta = (i * Math.PI) / 3;
      let px = Math.cos(theta) * this.size;
      let py = Math.sin(theta) * this.size;
      i === 0 ? ctx.moveTo(px, py) : ctx.lineTo(px, py);
    }
    ctx.closePath();
    ctx.strokeStyle = this.color;
    ctx.lineWidth = 3;
    ctx.shadowBlur = 15;
    ctx.shadowColor = this.color;
    ctx.stroke();
    ctx.restore();
  }
}

let bolts = [];
for (let i = 0; i < 40; i++) bolts.push(new Bolt());

function animate(time) {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  bolts.forEach(b => b.draw(time));
  requestAnimationFrame(animate);
}
animate(0);

// ===== Quiz Logic =====
const easyQuestions = [
  { text: "Which law explains the relationship between pressure and volume of gases?", options: ["Newton's Law", "Hooke's Law", "Ohm's Law", "Boyle's Law"], correct: 3 },
  { text: "Which instrument is used to measure temperature?", options: ["Manometer", "Thermometer", "Hygrometer", "Barometer"], correct: 1 },
  { text: "What type of energy does a moving object have?", options: ["Kinetic Energy", "Thermal Energy", "Potential Energy", "Nuclear Energy"], correct: 0 },
  { text: "Which metal is primarily used in making aircraft?", options: ["Aluminum", "Lead", "Iron", "Copper"], correct: 0 },
  { text: "Which of these is a heat engine?", options: ["Battery", "Pump", "Motor", "IC Engine"], correct: 3 },
  { text: "What does CAD stand for?", options: ["Current Angular Dynamics", "Computer-Aided Design", "Controlled Automatic Draft", "Central Axis Design"], correct: 1 },
  { text: "What is used to reduce friction between moving parts?", options: ["Clamps", "Lubricants", "Magnets", "Springs"], correct: 1 },
  { text: "Which is stronger: cast iron or mild steel?", options: ["Aluminum", "Copper", "Cast Iron", "Mild Steel"], correct: 2 },
  { text: "What does CNC stand for?", options: ["Computer Numerical Control", "Computer Number Code", "Central Network Control", "Control Node Circuit"], correct: 0 },
  { text: "Which unit is used for force?", options: ["Pascal", "Newton", "Joule", "Watt"], correct: 1 },
  { text: "What is the function of a flywheel?", options: ["Store Energy", "Control Temperature", "Reduce Weight", "Increase Speed"], correct: 0 },
  { text: "Which is NOT a simple machine?", options: ["Inclined Plane", "Pulley", "Gearbox", "Lever"], correct: 2 },
  { text: "Which metal is commonly used in bearings?", options: ["Brass", "Steel", "Lead", "Babbitt Metal"], correct: 3 },
  { text: "Which is the hardest material known?", options: ["Tungsten", "Steel", "Diamond", "Graphite"], correct: 2 },
  { text: "What is the SI unit of power?", options: ["Newton", "Watt", "Pascal", "Joule"], correct: 1 }
];

const mediumQuestions = [
  { text: "Which cycle is used in petrol engines?", options: ["Diesel Cycle", "Otto Cycle", "Brayton Cycle", "Rankine Cycle"], correct: 1 },
  { text: "Which mechanical property is tested using a Charpy test?", options: ["Elasticity", "Ductility", "Impact Strength", "Hardness"], correct: 2 },
  { text: "Which device converts reciprocating motion into rotary motion?", options: ["Gear", "Camshaft", "Flywheel", "Crankshaft"], correct: 3 },
  { text: "Which mechanism is used in shaping machines?", options: ["Cam Mechanism", "Quick Return Mechanism", "Four-Bar Mechanism", "Crank & Slotted Link"], correct: 1 },
  { text: "Which material is commonly used for making cutting tools?", options: ["High-Speed Steel", "Lead", "Copper", "Aluminum"], correct: 0 },
  { text: "Which law of thermodynamics defines entropy?", options: ["Second Law", "Zeroth Law", "Third Law", "First Law"], correct: 0 },
  { text: "Which welding process uses a filler rod and electric arc?", options: ["Gas Welding", "MIG Welding", "TIG Welding", "Spot Welding"], correct: 1 },
  { text: "Which type of stress is produced in a thin cylindrical vessel under pressure?", options: ["Hoop Stress", "Shear Stress", "Bending Stress", "Torsional Stress"], correct: 0 },
  { text: "What is the function of a governor in engines?", options: ["Increase Torque", "Cool Engine", "Reduce Fuel", "Control Speed"], correct: 3 },
  { text: "Which bearing is suitable for high radial load?", options: ["Ball Bearing", "Thrust Bearing", "Roller Bearing", "Magnetic Bearing"], correct: 2 }
];

const hardQuestions = [
  { text: "Which law defines the efficiency limit of heat engines?", options: ["First Law of Thermodynamics", "Hookeâ€™s Law", "Second Law of Thermodynamics", "Newtonâ€™s Law of Cooling"], correct: 2 },
  { text: "Which type of welding uses non-consumable tungsten electrodes?", options: ["MIG Welding", "Gas Welding", "Arc Welding", "TIG Welding"], correct: 3 },
  { text: "Which governor is most sensitive among mechanical types?", options: ["Watt Governor", "Hartnell Governor", "Proell Governor", "Porter Governor"], correct: 1 },
  { text: "Which stress-strain region shows permanent deformation?", options: ["Plastic Region", "Resilience Region", "Proportional Limit", "Elastic Region"], correct: 0 },
  { text: "What is the efficiency of a Carnot engine operating between 800K and 400K?", options: ["25%", "75%", "33%", "50%"], correct: 3 }
];


function pickRandom(arr, n) {
      const copy = [...arr];
      const result = [];
      for (let i = 0; i < n && copy.length > 0; i++) {
        const index = Math.floor(Math.random() * copy.length);
        result.push(copy.splice(index, 1)[0]);
      }
      return result;
    }

    const questions = [
      ...pickRandom(easyQuestions, 2),
      ...pickRandom(mediumQuestions, 2),
      ...pickRandom(hardQuestions, 1)
    ];

    let currentIndex = 0;
    let score = 0;
    let attempts = 0;
    let timer;
    let timeLeft = 15;
    let answered = false;

    const questionEl = document.getElementById("question");
    const optionsEl = document.getElementById("options");
    const scoreEl = document.getElementById("score");
    const timerEl = document.getElementById("timer");
    const playAgainContainer = document.getElementById("playAgainContainer");
const prevScore = localStorage.getItem("civilQuizScore");
const prevAttempts = localStorage.getItem("civilQuizAttempts");

if (prevScore && prevAttempts) {
  scoreEl.textContent = `Last Score: ${prevScore} | Attempts: ${prevAttempts}`;
}
function shuffleArray(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

    // ===== Timer =====
    function startTimer() {
      clearInterval(timer);
      timeLeft = 15;
      timerEl.textContent = timeLeft;
      timer = setInterval(() => {
        timeLeft--;
        timerEl.textContent = timeLeft;
       if (timeLeft <= 0) {
  clearInterval(timer);

  if (!answered) {
    answered = true;
    attempts++;
    scoreEl.textContent = `Score: ${score} | Attempts: ${attempts}`;
    showCorrectAnswer();
    setTimeout(nextQuestion, 1500);
  }
}
      }, 1000);
    }
function shuffleOptions(question) {
  const optionsWithIndex = question.options.map((opt, i) => ({
    text: opt,
    isCorrect: i === question.correct
  }));

  // Fisherâ€“Yates shuffle
  for (let i = optionsWithIndex.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [optionsWithIndex[i], optionsWithIndex[j]] =
    [optionsWithIndex[j], optionsWithIndex[i]];
  }

  question.options = optionsWithIndex.map(o => o.text);
  question.correct = optionsWithIndex.findIndex(o => o.isCorrect);
}

    // ===== Load Question =====
    function loadQuestion() {
      answered = false;
      const q = questions[currentIndex];
      shuffleOptions(q);
      optionsEl.innerHTML = "";
      questionEl.textContent = q.text;
      q.options.forEach((opt, i) => {
        const card = document.createElement("div");
        card.className = "card";
        const front = document.createElement("div");
        front.className = "face front";
        front.textContent = opt;
        const back = document.createElement("div");
        back.className = "face back";
        back.textContent = (i === q.correct) ? "Correct!" : "Wrong!";
        card.appendChild(front);
        card.appendChild(back);
        card.addEventListener("click", () => selectOption(card, i));
        optionsEl.appendChild(card);
      });
      startTimer();
    }
function showCorrectAnswer() {
  const q = questions[currentIndex];
  const cards = document.querySelectorAll(".card");

  cards.forEach((card, i) => {
    card.classList.add("flipped");
    const back = card.querySelector(".back");

    if (i === q.correct) {
      back.style.background = "green";
      back.textContent = "Correct!";
    } else {
      back.style.background = "red";
      back.textContent = "Wrong!";
    }
  });
}

    // ===== Select Option =====
function selectOption(selectedCard, index) {
  if (answered) return;
  answered = true;

  clearInterval(timer);
  attempts++;

  const correctIndex = questions[currentIndex].correct;
  if (index === correctIndex) score += 2;

  scoreEl.textContent = `Score: ${score} | Attempts: ${attempts}`;

  showCorrectAnswer();
  setTimeout(nextQuestion, 1500);
}


    // ===== Next Question =====
   function nextQuestion() {
  currentIndex++;

  if (currentIndex < questions.length) {
    loadQuestion();
  } else {
    questionEl.textContent =
      `Quiz Finished!
Final Score: ${score}
Attempts: ${attempts}`;

    optionsEl.innerHTML = "";
    timerEl.textContent = "";

    // ðŸ‘‡ SAVE DATA
    localStorage.setItem("civilQuizScore", score);
    localStorage.setItem("civilQuizAttempts", attempts);

    playAgainContainer.style.display = "block";
  }
}

    // ===== Go to Departments =====
    function goToDepartments() {
      window.location.href = "departments.html";
    }

    // ===== Start Quiz =====
    loadQuestion();
  </script>
</body>
</html>
